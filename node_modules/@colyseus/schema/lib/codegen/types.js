"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getInheritanceTree = exports.Property = exports.Class = exports.Interface = exports.Context = exports.getCommentHeader = void 0;
var fs = require("fs");
var VERSION = JSON.parse(fs.readFileSync(__dirname + "/../../package.json").toString()).version;
var COMMENT_HEADER = "\nTHIS FILE HAS BEEN GENERATED AUTOMATICALLY\nDO NOT CHANGE IT MANUALLY UNLESS YOU KNOW WHAT YOU'RE DOING\n\nGENERATED USING @colyseus/schema " + VERSION + "\n";
function getCommentHeader(singleLineComment) {
    if (singleLineComment === void 0) { singleLineComment = "//"; }
    return "" + COMMENT_HEADER.split("\n").map(function (line) { return singleLineComment + " " + line; }).join("\n");
}
exports.getCommentHeader = getCommentHeader;
var Context = /** @class */ (function () {
    function Context() {
        this.classes = [];
        this.interfaces = [];
    }
    Context.prototype.getStructures = function () {
        var _this = this;
        return {
            classes: this.classes.filter(function (klass) {
                if (_this.isSchemaClass(klass)) {
                    return true;
                }
                else {
                    var parentClass = klass;
                    while (parentClass = _this.getParentClass(parentClass)) {
                        if (_this.isSchemaClass(parentClass)) {
                            return true;
                        }
                    }
                }
                return false;
            }),
            interfaces: this.interfaces,
        };
    };
    Context.prototype.addStructure = function (structure) {
        structure.context = this;
        if (structure instanceof Class) {
            this.classes.push(structure);
        }
        else if (structure instanceof Interface) {
            this.interfaces.push(structure);
        }
    };
    Context.prototype.getParentClass = function (klass) {
        return this.classes.find(function (c) { return c.name === klass.extends; });
    };
    Context.prototype.isSchemaClass = function (klass) {
        var isSchema = false;
        var currentClass = klass;
        while (!isSchema && currentClass) {
            isSchema = currentClass.extends === "Schema";
            currentClass = this.getParentClass(currentClass);
        }
        return isSchema;
    };
    return Context;
}());
exports.Context = Context;
var Interface = /** @class */ (function () {
    function Interface() {
        this.properties = [];
    }
    Interface.prototype.addProperty = function (property) {
        if (property.type.indexOf("[]") >= 0) {
            // is array!
            property.childType = property.type.match(/([^\[]+)/i)[1];
            property.type = "array";
            this.properties.push(property);
        }
        else {
            this.properties.push(property);
        }
    };
    return Interface;
}());
exports.Interface = Interface;
var Class = /** @class */ (function () {
    function Class() {
        this.properties = [];
    }
    Class.prototype.addProperty = function (property) {
        property.index = this.properties.length;
        this.properties.push(property);
    };
    Class.prototype.postProcessing = function () {
        /**
         * Ensure the proprierties `index` are correct using inheritance
         */
        var parentKlass = this;
        while (parentKlass &&
            (parentKlass = this.context.classes.find(function (k) { return k.name === parentKlass.extends; }))) {
            this.properties.forEach(function (prop) {
                prop.index += parentKlass.properties.length;
            });
        }
    };
    return Class;
}());
exports.Class = Class;
var Property = /** @class */ (function () {
    function Property() {
    }
    return Property;
}());
exports.Property = Property;
function getInheritanceTree(klass, allClasses, includeSelf) {
    if (includeSelf === void 0) { includeSelf = true; }
    var currentClass = klass;
    var inheritanceTree = [];
    if (includeSelf) {
        inheritanceTree.push(currentClass);
    }
    while (currentClass.extends !== "Schema") {
        currentClass = allClasses.find(function (klass) { return klass.name == currentClass.extends; });
        inheritanceTree.push(currentClass);
    }
    return inheritanceTree;
}
exports.getInheritanceTree = getInheritanceTree;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY29kZWdlbi90eXBlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx1QkFBeUI7QUFFekIsSUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLFNBQVMsR0FBRyxxQkFBcUIsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDO0FBQ2xHLElBQU0sY0FBYyxHQUFHLG1KQUlZLE9BQU8sT0FDekMsQ0FBQztBQUVGLFNBQWdCLGdCQUFnQixDQUFDLGlCQUFnQztJQUFoQyxrQ0FBQSxFQUFBLHdCQUFnQztJQUM3RCxPQUFPLEtBQUcsY0FBYyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBQSxJQUFJLElBQUksT0FBRyxpQkFBaUIsU0FBSSxJQUFNLEVBQTlCLENBQThCLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFHLENBQUM7QUFDbEcsQ0FBQztBQUZELDRDQUVDO0FBRUQ7SUFBQTtRQUNJLFlBQU8sR0FBWSxFQUFFLENBQUM7UUFDdEIsZUFBVSxHQUFnQixFQUFFLENBQUM7SUErQ2pDLENBQUM7SUE3Q0csK0JBQWEsR0FBYjtRQUFBLGlCQWlCQztRQWhCRyxPQUFPO1lBQ0gsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFVBQUEsS0FBSztnQkFDOUIsSUFBSSxLQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxFQUFFO29CQUMzQixPQUFPLElBQUksQ0FBQztpQkFDZjtxQkFBTTtvQkFDSCxJQUFJLFdBQVcsR0FBRyxLQUFLLENBQUM7b0JBQ3hCLE9BQU8sV0FBVyxHQUFHLEtBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLEVBQUU7d0JBQ25ELElBQUksS0FBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsRUFBRTs0QkFDakMs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Q0FBQyxDQUFDO1NBQ047SUFDTCxDQUFDO0lBQ0wsWUFBQztBQUFELENBQUMsQUExQkQsSUEwQkM7QUExQlksc0JBQUs7QUE0QmxCO0lBQUE7SUFNQSxDQUFDO0lBQUQsZUFBQztBQUFELENBQUMsQUFORCxJQU1DO0FBTlksNEJBQVE7QUFhckIsU0FBZ0Isa0JBQWtCLENBQUMsS0FBWSxFQUFFLFVBQW1CLEVBQUUsV0FBMkI7SUFBM0IsNEJBQUEsRUFBQSxrQkFBMkI7SUFDN0YsSUFBSSxZQUFZLEdBQUcsS0FBSyxDQUFDO0lBQ3pCLElBQUksZUFBZSxHQUFZLEVBQUUsQ0FBQztJQUVsQyxJQUFJLFdBQVcsRUFBRTtRQUNiLGVBQWUsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7S0FDdEM7SUFFRCxPQUFPLFlBQVksQ0FBQyxPQUFPLEtBQUssUUFBUSxFQUFFO1FBQ3RDLFlBQVksR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsS0FBSyxDQUFDLElBQUksSUFBSSxZQUFZLENBQUMsT0FBTyxFQUFsQyxDQUFrQyxDQUFDLENBQUM7UUFDNUUsZUFBZSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztLQUN0QztJQUVELE9BQU8sZUFBZSxDQUFDO0FBQzNCLENBQUM7QUFkRCxnREFjQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGZzIGZyb20gXCJmc1wiO1xuXG5jb25zdCBWRVJTSU9OID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoX19kaXJuYW1lICsgXCIvLi4vLi4vcGFja2FnZS5qc29uXCIpLnRvU3RyaW5nKCkpLnZlcnNpb247XG5jb25zdCBDT01NRU5UX0hFQURFUiA9IGBcblRISVMgRklMRSBIQVMgQkVFTiBHRU5FUkFURUQgQVVUT01BVElDQUxMWVxuRE8gTk9UIENIQU5HRSBJVCBNQU5VQUxMWSBVTkxFU1MgWU9VIEtOT1cgV0hBVCBZT1UnUkUgRE9JTkdcblxuR0VORVJBVEVEIFVTSU5HIEBjb2x5c2V1cy9zY2hlbWEgJHtWRVJTSU9OfVxuYDtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvbW1lbnRIZWFkZXIoc2luZ2xlTGluZUNvbW1lbnQ6IHN0cmluZyA9IFwiLy9cIikge1xuICAgIHJldHVybiBgJHtDT01NRU5UX0hFQURFUi5zcGxpdChcIlxcblwiKS5tYXAobGluZSA9PiBgJHtzaW5nbGVMaW5lQ29tbWVudH0gJHtsaW5lfWApLmpvaW4oXCJcXG5cIil9YDtcbn1cblxuZXhwb3J0IGNsYXNzIENvbnRleHQge1xuICAgIGNsYXNzZXM6IENsYXNzW10gPSBbXTtcbiAgICBpbnRlcmZhY2VzOiBJbnRlcmZhY2VbXSA9IFtdO1xuXG4gICAgZ2V0U3RydWN0dXJlcygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNsYXNzZXM6IHRoaXMuY2xhc3Nlcy5maWx0ZXIoa2xhc3MgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzU2NoZW1hQ2xhc3Moa2xhc3MpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBwYXJlbnRDbGFzcyA9IGtsYXNzO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAocGFyZW50Q2xhc3MgPSB0aGlzLmdldFBhcmVudENsYXNzKHBhcmVudENsYXNzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNTY2hlbWFDbGFzcyhwYXJlbnRDbGFzcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGludGVyZmFjZXM6IHRoaXMuaW50ZXJmYWNlcyxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBhZGRTdHJ1Y3R1cmUoc3RydWN0dXJlOiBJU3RydWN0dXJlKSB7XG4gICAgICAgIHN0cnVjdHVyZS5jb250ZXh0ID0gdGhpcztcblxuICAgICAgICBpZiAoc3RydWN0dXJlIGluc3RhbmNlb2YgQ2xhc3MpIHtcbiAgICAgICAgICAgIHRoaXMuY2xhc3Nlcy5wdXNoKHN0cnVjdHVyZSk7XG5cbiAgICAgICAgfSBlbHNlIGlmIChzdHJ1Y3R1cmUgaW5zdGFuY2VvZiBJbnRlcmZhY2UpIHtcbiAgICAgICAgICAgIHRoaXMuaW50ZXJmYWNlcy5wdXNoKHN0cnVjdHVyZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFBhcmVudENsYXNzKGtsYXNzOiBDbGFzcykge1xuICAgICAgICByZXR1cm4gdGhpcy5jbGFzc2VzLmZpbmQoYyA9PiBjLm5hbWUgPT09IGtsYXNzLmV4dGVuZHMpO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNTY2hlbWFDbGFzcyhrbGFzczogQ2xhc3MpIHtcbiAgICAgICAgbGV0IGlzU2NoZW1hOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAgICAgbGV0IGN1cnJlbnRDbGFzcyA9IGtsYXNzO1xuICAgICAgICB3aGlsZSAoIWlzU2NoZW1hICYmIGN1cnJlbnRDbGFzcykge1xuICAgICAgICAgICAgaXNTY2hlbWEgPSBjdXJyZW50Q2xhc3MuZXh0ZW5kcyA9PT0gXCJTY2hlbWFcIjtcbiAgICAgICAgICAgIGN1cnJlbnRDbGFzcyA9IHRoaXMuZ2V0UGFyZW50Q2xhc3MoY3VycmVudENsYXNzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBpc1NjaGVtYVxuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJU3RydWN0dXJlIHtcbiAgICBjb250ZXh0OiBDb250ZXh0O1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBwcm9wZXJ0aWVzOiBQcm9wZXJ0eVtdO1xuICAgIGFkZFByb3BlcnR5KHByb3BlcnR5OiBQcm9wZXJ0eSk7XG59XG5cbmV4cG9ydCBjbGFzcyBJbnRlcmZhY2UgaW1wbGVtZW50cyBJU3RydWN0dXJlIHtcbiAgICBjb250ZXh0OiBDb250ZXh0O1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBwcm9wZXJ0aWVzOiBQcm9wZXJ0eVtdID0gW107XG5cbiAgICBhZGRQcm9wZXJ0eShwcm9wZXJ0eTogUHJvcGVydHkpIHtcbiAgICAgICAgaWYgKHByb3BlcnR5LnR5cGUuaW5kZXhPZihcIltdXCIpID49IDApIHtcbiAgICAgICAgICAgIC8vIGlzIGFycmF5IVxuICAgICAgICAgICAgcHJvcGVydHkuY2hpbGRUeXBlID0gcHJvcGVydHkudHlwZS5tYXRjaCgvKFteXFxbXSspL2kpWzFdO1xuICAgICAgICAgICAgcHJvcGVydHkudHlwZSA9IFwiYXJyYXlcIjtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydGllcy5wdXNoKHByb3BlcnR5KTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wcm9wZXJ0aWVzLnB1c2gocHJvcGVydHkpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ2xhc3MgaW1wbGVtZW50cyBJU3RydWN0dXJlIHtcbiAgICBjb250ZXh0OiBDb250ZXh0O1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBwcm9wZXJ0aWVzOiBQcm9wZXJ0eVtdID0gW107XG4gICAgZXh0ZW5kczogc3RyaW5nO1xuXG4gICAgYWRkUHJvcGVydHkocHJvcGVydHk6IFByb3BlcnR5KSB7XG4gICAgICAgIHByb3BlcnR5LmluZGV4ID0gdGhpcy5wcm9wZXJ0aWVzLmxlbmd0aDtcbiAgICAgICAgdGhpcy5wcm9wZXJ0aWVzLnB1c2gocHJvcGVydHkpO1xuICAgIH1cblxuICAgIHBvc3RQcm9jZXNzaW5nKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogRW5zdXJlIHRoZSBwcm9wcmllcnRpZXMgYGluZGV4YCBhcmUgY29ycmVjdCB1c2luZyBpbmhlcml0YW5jZVxuICAgICAgICAgKi9cbiAgICAgICAgbGV0IHBhcmVudEtsYXNzOiBDbGFzcyA9IHRoaXM7XG5cbiAgICAgICAgd2hpbGUgKFxuICAgICAgICAgICAgcGFyZW50S2xhc3MgJiZcbiAgICAgICAgICAgIChwYXJlbnRLbGFzcyA9IHRoaXMuY29udGV4dC5jbGFzc2VzLmZpbmQoayA9PiBrLm5hbWUgPT09IHBhcmVudEtsYXNzLmV4dGVuZHMpKVxuICAgICAgICApIHtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydGllcy5mb3JFYWNoKHByb3AgPT4ge1xuICAgICAgICAgICAgICAgIHByb3AuaW5kZXggKz0gcGFyZW50S2xhc3MucHJvcGVydGllcy5sZW5ndGg7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFByb3BlcnR5IHtcbiAgICBpbmRleDogbnVtYmVyO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICB0eXBlOiBzdHJpbmc7XG4gICAgY2hpbGRUeXBlOiBzdHJpbmc7XG4gICAgZGVwcmVjYXRlZD86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmlsZSB7XG4gICAgbmFtZTogc3RyaW5nXG4gICAgY29udGVudDogc3RyaW5nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW5oZXJpdGFuY2VUcmVlKGtsYXNzOiBDbGFzcywgYWxsQ2xhc3NlczogQ2xhc3NbXSwgaW5jbHVkZVNlbGY6IGJvb2xlYW4gPSB0cnVlKSB7XG4gICAgbGV0IGN1cnJlbnRDbGFzcyA9IGtsYXNzO1xuICAgIGxldCBpbmhlcml0YW5jZVRyZWU6IENsYXNzW10gPSBbXTtcblxuICAgIGlmIChpbmNsdWRlU2VsZikge1xuICAgICAgICBpbmhlcml0YW5jZVRyZWUucHVzaChjdXJyZW50Q2xhc3MpO1xuICAgIH1cblxuICAgIHdoaWxlIChjdXJyZW50Q2xhc3MuZXh0ZW5kcyAhPT0gXCJTY2hlbWFcIikge1xuICAgICAgICBjdXJyZW50Q2xhc3MgPSBhbGxDbGFzc2VzLmZpbmQoa2xhc3MgPT4ga2xhc3MubmFtZSA9PSBjdXJyZW50Q2xhc3MuZXh0ZW5kcyk7XG4gICAgICAgIGluaGVyaXRhbmNlVHJlZS5wdXNoKGN1cnJlbnRDbGFzcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGluaGVyaXRhbmNlVHJlZTtcbn1cbiJdfQ==